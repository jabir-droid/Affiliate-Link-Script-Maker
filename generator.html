<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Detail Produk & Konfigurasi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1b33; --panel:rgba(20,34,64,.72); --border:rgba(154,175,210,.25);
      --txt:#eaf1ff; --muted:#b4c0d8; --blue:#12b3ff; --purple:#7c5cff; --mint:#30e0c3;
    }
    body{margin:0;background:var(--bg);color:var(--txt);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
    .g-title{background:linear-gradient(90deg,#60a5fa,#8b5cf6);-webkit-background-clip:text;background-clip:text;color:transparent}
    .glass{background:var(--panel);border:1px solid var(--border);backdrop-filter:blur(10px);border-radius:18px;box-shadow:0 18px 50px rgba(0,0,0,.35)}
    .pill{background:rgba(17,42,75,.9);border:1px solid rgba(124,58,237,.35);box-shadow:0 0 24px rgba(124,58,237,.20), inset 0 0 24px rgba(48,224,195,.18);border-radius:14px}
    .inp{width:100%;border:1px solid var(--border);background:rgba(15,28,52,.75);padding:15px 16px;border-radius:14px;color:var(--txt);outline:none}
    .inp:focus{border-color:#4ea8ff;box-shadow:0 0 0 3px rgba(78,168,255,.2)}
    .seg input{display:none}
    .seg label{border:1px solid var(--border);background:rgba(15,28,52,.75);padding:16px;border-radius:16px;cursor:pointer;text-align:center;font-weight:600}
    .seg input:checked + label{background:linear-gradient(90deg, rgba(18,179,255,.25), rgba(124,92,255,.25));border-color:#7c5cff;box-shadow:0 0 18px rgba(124,92,255,.25)}
    .cta{background:linear-gradient(90deg,#12b3ff,#7b5cff);box-shadow:0 12px 40px rgba(112,80,255,.35)}
    .guideHead{border-bottom:1px solid rgba(154,175,210,.2)}
    .back{background:rgba(15,28,52,.8);border:1px solid var(--border);width:46px;height:46px;border-radius:12px;display:grid;place-items:center}
  </style>
</head>
<body>
  <main class="max-w-6xl mx-auto px-6 pt-8 pb-24">
    <!-- header: tombol kembali + judul + actions kanan -->
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-4">
        <button onclick="history.back()" class="back">‚Üê</button>
        <div>
          <h1 class="g-title text-[44px] leading-[1.05] font-extrabold">Detail Produk & Konfigurasi</h1>
          <p class="text-[var(--muted)] mt-1 text-base">Buat skrip promosi afiliasi Anda</p>
        </div>
      </div>
      <div class="flex items-center gap-4">
        <button id="btnGuide" class="glass px-5 py-2.5 rounded-xl text-base flex items-center gap-2">
          <span class="text-sky-300">‚Ñπ</span> Panduan
        </button>
        <div class="pill px-5 py-2.5 text-base">
          Kuota Harian <b id="quotaNow" class="ml-1">1000</b> / 1000
          <button id="btnRefreshQuota" class="ml-3 underline text-teal-300">Refresh</button>
        </div>
      </div>
    </div>

    <!-- panel Panduan -->
    <section id="guidePanel" class="glass mt-8">
      <div class="guideHead px-6 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="w-4 h-4 rounded-sm" style="background:linear-gradient(90deg,#60a5fa,#8b5cf6)"></span>
          <h3 class="text-xl font-extrabold">Panduan Penggunaan</h3>
        </div>
        <button id="closeGuide" class="back" style="width:36px;height:36px;border-radius:10px">‚úï</button>
      </div>
      <div class="p-6 md:p-8">
        <ol class="space-y-5 text-[18px] leading-relaxed">
          <li class="flex gap-3"><span class="text-emerald-400">‚úî</span><span>Masukkan <b>link produk</b> dan info dasar produk Anda</span></li>
          <li class="flex gap-3"><span class="text-emerald-400">‚úî</span><span>Tambahkan <b>kelebihan/keunggulan</b> produk (minimal 1)</span></li>
          <li class="flex gap-3"><span class="text-emerald-400">‚úî</span><span>Pilih <b>gaya bahasa</b> yang sesuai dengan target audiens</span></li>
          <li class="flex gap-3"><span class="text-emerald-400">‚úî</span><span>Tentukan <b>panjang tulisan</b> yang diinginkan</span></li>
          <li class="flex gap-3"><span class="text-emerald-400">‚úî</span><span>Klik <b>‚ÄòGenerate Konten Cepat‚Äô</b> untuk menghasilkan konten</span></li>
          <li class="flex gap-3"><span class="text-emerald-400">‚úî</span><span><b>Salin hasil</b> atau download untuk digunakan</span></li>
        </ol>
      </div>
    </section>

    <!-- form card besar -->
    <section class="glass mt-6">
      <div class="px-6 py-4 guideHead flex items-center gap-2">
        <span>üìù</span><h2 class="text-[22px] font-extrabold">Form Input Produk</h2>
      </div>

      <div class="p-6 md:p-8 grid gap-6">
        <!-- link -->
        <div>
          <label class="block mb-2 text-[var(--muted)] font-semibold">Link Produk <span class="text-sky-300">*</span></label>
          <input id="productUrl" type="url" placeholder="https://tokopedia.com/..." class="inp">
        </div>

        <!-- nama produk -->
        <div>
          <label class="block mb-2 text-[var(--muted)] font-semibold">Nama / Jenis Produk <span class="text-sky-300">*</span></label>
          <input id="productTopic" type="text" placeholder="Contoh: Smartwatch X Pro" class="inp">
        </div>

        <!-- kelebihan: field + tombol tambah kanan -->
        <div>
          <div class="flex items-center justify-between mb-2">
            <label class="block text-[var(--muted)] font-semibold">Kelebihan / Keunggulan Produk <span class="text-sky-300">*</span></label>
            <button id="addDescTop" class="px-4 py-2 rounded-xl text-white" style="background:linear-gradient(90deg,#12b3ff,#7b5cff)">+ Tambah</button>
          </div>
          <input id="descInput" class="inp" placeholder="Contoh: Tahan Air IP68, Baterai 7 Hari, dll">
          <div id="chips" class="mt-3"></div>
        </div>

        <!-- jumlah -->
        <div>
          <label class="block mb-2 text-[var(--muted)] font-semibold">Jumlah Variasi Konten</label>
          <input id="count" type="number" min="1" max="10" value="3" class="inp">
          <p class="text-xs mt-1 text-[var(--muted)]">Antara 1‚Äì10 variasi</p>
        </div>

        <!-- segmented controls -->
        <div class="grid gap-8">
          <div>
            <label class="block mb-3 text-[var(--muted)] font-semibold">Gaya Bahasa</label>
            <div class="seg grid md:grid-cols-2 gap-4">
              <input type="radio" name="style" id="sty1" value="Santai & Ramah" checked><label for="sty1">Santai & Ramah</label>
              <input type="radio" name="style" id="sty2" value="Formal & Informatif"><label for="sty2">Formal & Informatif</label>
              <input type="radio" name="style" id="sty3" value="Promosi Soft Selling"><label for="sty3">Promosi Soft Selling</label>
              <input type="radio" name="style" id="sty4" value="Penulisan Naskah Iklan (AIDA/PAS)"><label for="sty4">Penulisan Naskah Iklan (AIDA/PAS)</label>
            </div>
          </div>

          <div>
            <label class="block mb-3 text-[var(--muted)] font-semibold">Panjang Tulisan</label>
            <div class="seg grid md:grid-cols-3 gap-4">
              <input type="radio" name="length" id="len1" value="Pendek (1 paragraf)"><label for="len1">Pendek (1 paragraf)</label>
              <input type="radio" name="length" id="len2" value="Sedang (2-3 paragraf)" checked><label for="len2">Sedang (2-3 paragraf)</label>
              <input type="radio" name="length" id="len3" value="Panjang (artikel mini)"><label for="len3">Panjang (artikel mini)</label>
            </div>
          </div>
        </div>

        <!-- CTA full width -->
        <button id="btnGenerate" class="mt-2 w-full inline-flex items-center justify-center gap-3 px-7 py-5 rounded-2xl text-white text-lg font-extrabold cta">
          ‚ú® Mulai Hasilkan
        </button>
        <span id="err" class="text-rose-300"></span>
      </div>
    </section>

    <section id="results" class="mt-8 grid gap-6"></section>

    <footer class="mt-10 text-center text-[var(--muted)] text-sm">
      ¬© 2025 ‚Äî Dibuat untuk Mempermudah promosi afiliasi.
    </footer>
  </main>

  <script>
    // toggle guide
    const panel = document.getElementById('guidePanel');
    document.getElementById('btnGuide').onclick = () => panel.style.display = panel.style.display === 'none' ? '' : 'none';
    document.getElementById('closeGuide').onclick = () => panel.style.display = 'none';

    // kuota
    async function loadQuota(){
      try{
        const r=await fetch('/api/quota'); const j=await r.json();
        document.getElementById('quotaNow').textContent = j?.remaining ?? '1000';
      }catch{}
    }
    document.getElementById('btnRefreshQuota').addEventListener('click', loadQuota);
    loadQuota();

    // chips (kelebihan)
    const chipsEl=document.getElementById('chips'), inputEl=document.getElementById('descInput');
    const btnTop=document.getElementById('addDescTop');
    let chips=[];
    const render=()=>{chipsEl.innerHTML='';chips.forEach((t,i)=>{const s=document.createElement('span');s.className='inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm';s.style.cssText='background:rgba(255,255,255,.06);border:1px solid var(--border)';s.innerHTML=`${escapeHtml(t)} <button data-i="${i}" title="hapus" class="text-[var(--muted)]">‚úï</button>`;s.querySelector('button').onclick=e=>{chips.splice(+e.target.dataset.i,1);render()};chipsEl.appendChild(s);})};
    const add=()=>{const v=inputEl.value.trim(); if(!v) return; chips.push(v); inputEl.value=''; render();};
    inputEl.addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); add(); }});
    btnTop.addEventListener('click', add);

    // generate
    document.getElementById('btnGenerate').addEventListener('click', async ()=>{
      const err=document.getElementById('err'); err.textContent='';
      const url=document.getElementById('productUrl').value.trim();
      const topic=document.getElementById('productTopic').value.trim();
      const style=document.querySelector('input[name="style"]:checked')?.value || 'Santai & Ramah';
      const length=document.querySelector('input[name="length"]:checked')?.value || 'Sedang (2-3 paragraf)';
      const count=Math.max(1,Math.min(10, Number(document.getElementById('count').value || 3)));
      const descriptions=chips.slice();
      if(!url) return err.textContent='Link Produk wajib diisi.';
      if(!topic) return err.textContent='Nama / Jenis Produk wajib diisi.';
      if(descriptions.length<1) return err.textContent='Minimal 1 kelebihan / keunggulan.';

      const btn=this; const b=document.getElementById('btnGenerate');
      const orig=b.innerHTML; b.disabled=true; b.innerHTML='Sedang meracik‚Ä¶';
      try{
        const r=await fetch('/api/generate',{method:'POST',headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ linkProduk:url, topik:topic, deskripsi:descriptions, gaya:style, panjang:length, jumlah:count,
            link:url, topic, descriptions, style, length, generateCount:count, count })
        });
        const raw=await r.text(); let j=null; try{ j=raw? JSON.parse(raw): null }catch{};
        if(!r.ok || !j || !j.ok) throw new Error(j?.message || raw || 'Gagal generate');
        renderResults(j.scripts||[]); loadQuota();
      }catch(e){ err.textContent=e.message; }
      finally{ b.disabled=false; b.innerHTML=orig; }
    });

    function renderResults(scripts){
      const box=document.getElementById('results'); box.innerHTML='';
      scripts.forEach((s,i)=>{
        const card=document.createElement('div'); card.className='glass p-6';
        card.innerHTML=`<h3 class="text-xl font-bold mb-2" style="color:#c7d2fe">Variasi ${i+1} ‚Ä¢ ${escapeHtml(s.title||'')}</h3>
                         <p class="whitespace-pre-wrap leading-relaxed">${escapeHtml(s.content||'')}</p>
                         <div class="mt-4 flex justify-end"><button class="px-4 py-2 rounded-lg" style="background:#334155;color:white" data-copy>Salin</button></div>`;
        card.querySelector('[data-copy]').onclick=()=>{ navigator.clipboard.writeText(s.content||'').then(()=>{ const b=card.querySelector('[data-copy]'); b.textContent='Tersalin!'; setTimeout(()=>b.textContent='Salin',1500); }); };
        box.appendChild(card);
      });
    }
    function escapeHtml(s){return String(s).replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]))}
  </script>
</body>
</html>
