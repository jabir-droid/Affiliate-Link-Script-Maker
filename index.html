<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Affiliate Link Script Maker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .card { transition: all .3s; border:1px solid rgba(255,255,255,.1); }
    .card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px rgba(0,0,0,.1); }
    .btn { display:inline-flex; align-items:center; gap:.5rem; padding:.6rem 1.2rem; border-radius:.5rem; font-weight:500; transition:.2s; }
    .btn-primary { background:#4f46e5; color:white; }
    .btn-primary:hover { background:#4338ca; box-shadow:0 4px 14px rgba(79,70,229,.39); }
    #loader { border:4px solid #4a5568; border-top:4px solid #4f46e5; border-radius:50%; width:40px; height:40px; animation: spin 1s linear infinite; }
    @keyframes spin {0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
  </style>
</head>
<body class="bg-slate-900 text-gray-200">
  <div class="container mx-auto p-4 md:p-8 max-w-4xl">
    <!-- Header -->
    <header class="text-center mb-8">
      <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-sky-400 to-indigo-400 bg-clip-text text-transparent">
        Affiliate Link Script Maker
      </h1>
      <p class="mt-2 text-lg text-gray-300">Tempel link produk, tambahkan detail singkat, lalu biarkan AI bikin skrip promosi yang keren & variatif ✨</p>
    </header>

    <!-- Input Card -->
    <div class="card bg-slate-800/50 p-6 md:p-8 backdrop-blur-xl border-slate-700 mb-8">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Link Produk -->
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-300 mb-1">Link Produk (wajib)</label>
          <input type="url" id="productUrl" placeholder="https://contoh.toko/produk-x" 
            class="w-full p-2 border border-slate-600 rounded-md bg-slate-700 placeholder-gray-400">
        </div>

        <!-- Topic Hint -->
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-300 mb-1">Link ini bahas apa?</label>
          <input type="text" id="topicHint" 
            placeholder="Contoh: Sepatu lari Nike / Blender portable 300W / Earbuds gaming"
            class="w-full p-2 border border-slate-600 rounded-md bg-slate-700 placeholder-gray-400">
        </div>

        <!-- Custom Summary -->
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-300 mb-1">Deskripsi singkat (1–2 kalimat)</label>
          <textarea id="customSummary" rows="2"
            placeholder="Contoh: Bantalan empuk, nyaman dipakai long run. Desain modern, ukuran 39–44."
            class="w-full p-2 border border-slate-600 rounded-md bg-slate-700 placeholder-gray-400"></textarea>
        </div>

        <!-- Jumlah -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1">Jumlah Hasil</label>
          <input type="number" id="generateCount" value="2" min="1" max="5"
            class="w-full p-2 border border-slate-600 rounded-md bg-slate-700">
        </div>
        <!-- Gaya -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1">Gaya Bahasa</label>
          <select id="languageStyle" class="w-full p-2 border border-slate-600 rounded-md bg-slate-700">
            <option>Gen Z</option>
            <option>Persuasif & Menjual</option>
            <option>Informatif & Edukatif</option>
            <option>Santai & Kasual</option>
            <option>Ulasan Jujur</option>
          </select>
        </div>
        <!-- Panjang -->
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-300 mb-1">Panjang Tulisan</label>
          <select id="contentLength" class="w-full p-2 border border-slate-600 rounded-md bg-slate-700">
            <option>Pendek (~50 kata)</option>
            <option>Sedang (~150 kata)</option>
            <option>Panjang (300+ kata)</option>
          </select>
        </div>
      </div>

      <div class="mt-8 text-center">
        <button id="generateBtn" class="btn btn-primary w-full md:w-auto">
          <i data-lucide="sparkles" class="w-5 h-5"></i>
          <span>Generate Script!</span>
        </button>
      </div>
    </div>

    <!-- Output -->
    <div id="outputSection" class="space-y-6"></div>
    <div id="loaderContainer" class="hidden flex-col items-center text-center">
      <div id="loader"></div>
      <p class="mt-3 text-gray-400">AI sedang meracik kata-kata...</p>
    </div>
    <div id="error-message" class="hidden card bg-red-900/20 border-red-500/30 p-4 text-center mt-6">
      <p class="font-semibold text-red-400">Oops, terjadi kesalahan!</p>
      <p id="error-text" class="text-red-400 text-sm mt-1"></p>
    </div>
  </div>

  <script type="module">
    lucide.createIcons();
    const outputSection = document.getElementById("outputSection");
    const loaderContainer = document.getElementById("loaderContainer");
    const errorBox = document.getElementById("error-message");
    const errorText = document.getElementById("error-text");
    const btn = document.getElementById("generateBtn");

    function showError(msg){ errorText.textContent = msg; errorBox.classList.remove("hidden"); }
    function hideError(){ errorBox.classList.add("hidden"); }

    async function generateContent(){
      const linkProduk = document.getElementById("productUrl").value.trim();
      const gaya = document.getElementById("languageStyle").value;
      const panjang = document.getElementById("contentLength").value;
      const generateCount = document.getElementById("generateCount").value;
      const topicHint = document.getElementById("topicHint").value.trim();
      const customSummary = document.getElementById("customSummary").value.trim();

      if(!linkProduk){ showError("Link produk wajib diisi."); return; }
      hideError();

      outputSection.innerHTML = "";
      loaderContainer.classList.remove("hidden");
      btn.disabled = true;

      try{
        const resp = await fetch("/api/generate", {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body: JSON.stringify({ linkProduk, gaya, panjang, topicHint, customSummary, count: generateCount })
        });
        const data = await resp.json();
        loaderContainer.classList.add("hidden");
        btn.disabled = false;

        if(!resp.ok || data.error){
          showError(data.error || "Gagal memproses.");
          return;
        }

        const card = document.createElement("div");
        card.className="card p-6 bg-slate-800/50 border-slate-700";
        card.innerHTML = `<pre class="whitespace-pre-wrap text-gray-200">${data.result}</pre>`;
        outputSection.appendChild(card);
      }catch(e){
        showError("Error: "+e.message);
        loaderContainer.classList.add("hidden");
        btn.disabled = false;
      }
    }
    btn.addEventListener("click",generateContent);
  </script>
</body>
</html>
